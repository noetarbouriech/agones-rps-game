<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <link
            rel="stylesheet"
            href="https://unpkg.com/papercss@1.9.2/dist/paper.min.css"
        />
        <title>Rock Paper Scissors</title>
    </head>
    <body style="min-height: 100vh; display: flex; justify-content: center">
        <div style="text-align: center">
            <button id="findBtn" class="btn">Play</button>
            <h1 id="status" style="display: none; margin-top: 1rem">
                Looking for a game...
            </h1>
        </div>

        <script>
            let ws = null;
            const playBtn = document.getElementById("findBtn");
            const status = document.getElementById("status");

            function openMatchmaking() {
                ws = new WebSocket("ws://" + location.host + "/ws");

                status.style.display = "block";
                findBtn.disabled = true;

                ws.onmessage = (e) => {
                    window.location.href = `${e.data}`;
                };

                ws.onclose = (ev) => {
                    // if the connection closes before redirect, reset UI so user can retry
                    status.style.display = "none";
                    ws = null;
                    findBtn.disabled = false;
                };

                ws.onerror = (err) => {
                    console.error("WebSocket error", err);
                };
            }

            playBtn.addEventListener("click", openMatchmaking);

            window.addEventListener("beforeunload", () => {
                if (ws) ws.close();
            });
        </script>
    </body>
</html>
